- name: Get existing credentials
  uri:
    url: "{{URL}}/credentials/store/system/domain/_/api/json?tree=credentials[id]"
    method: GET
    user: "{{ APP_KEYS.APP_USER }}"
    password: "{{ APP_KEYS.APP_PASS }}"
    force_basic_auth: yes
    redirected: true
  register: credentials

- name: Delete secret
  uri:
    url: "{{ URL }}/credentials/store/system/domain/_/credential/{{ item.id }}/doDelete"
    method: POST
    user: "{{ APP_KEYS.APP_USER }}"
    password: "{{ APP_KEYS.APP_PASS }}"
    body_format: form-urlencoded
    force_basic_auth: yes
    redirected: true
  loop: "{{ credentials.json.credentials }}"